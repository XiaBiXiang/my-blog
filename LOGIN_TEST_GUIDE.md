# 登录测试指南

## 当前用户信息

根据数据库查询，当前系统中有以下用户：

| 用户名     | 邮箱              | 密码             |
| ---------- | ----------------- | ---------------- |
| 3331631570 | 3331631570@qq.com | 注册时设置的密码 |

## 测试步骤

### 1. 使用用户名登录

1. 刷新浏览器页面（清除缓存）
2. 访问登录页面：http://localhost:3000/login
3. 输入：
   - 邮箱或用户名：`3331631570`
   - 密码：注册时使用的密码
4. 点击"登录"按钮
5. 打开浏览器控制台（F12），查看日志

**预期日志输出：**

```
=== 登录开始 ===
输入的标识符: 3331631570
检测到用户名，查询对应邮箱...
查询条件: username = 3331631570
查询结果: {profile: {email: "3331631570@qq.com"}, profileError: null}
找到对应邮箱: 3331631570@qq.com
使用邮箱登录: 3331631570@qq.com
登录响应: {hasData: true, hasUser: true, error: null}
=== 登录成功 ===
```

### 2. 使用邮箱登录

1. 输入：
   - 邮箱或用户名：`3331631570@qq.com`
   - 密码：注册时使用的密码
2. 点击"登录"按钮

**预期日志输出：**

```
=== 登录开始 ===
输入的标识符: 3331631570@qq.com
检测到邮箱，直接登录
使用邮箱登录: 3331631570@qq.com
登录响应: {hasData: true, hasUser: true, error: null}
=== 登录成功 ===
```

## 常见错误及解决

### 错误 1: "数据库操作失败，请稍后重试"

**可能原因：**

- Supabase 客户端配置问题
- 网络连接问题
- RLS 策略问题

**调试步骤：**

1. 检查控制台日志，查看具体错误信息
2. 确认环境变量是否正确：
   ```bash
   cat .env.local
   ```
3. 测试数据库连接：
   ```sql
   SELECT * FROM profiles LIMIT 1;
   ```

### 错误 2: "用户名或密码错误"

**可能原因：**

- 用户名输入错误（注意：你的用户名是 `3331631570`，不是 `xbx`）
- 密码输入错误
- profiles 表中没有该用户记录

**解决方法：**

1. 确认输入的用户名是 `3331631570`
2. 确认密码正确
3. 检查数据库：
   ```sql
   SELECT username, email FROM profiles;
   ```

### 错误 3: "Invalid login credentials"

**可能原因：**

- 密码错误
- 邮箱不存在

**解决方法：**

1. 确认密码正确
2. 尝试使用邮箱登录
3. 如果忘记密码，需要重新注册

## 调试技巧

### 1. 查看详细日志

打开浏览器控制台（F12），切换到 Console 标签，可以看到详细的登录流程日志。

### 2. 检查网络请求

在控制台的 Network 标签中，筛选 "supabase" 相关的请求，查看：

- 请求 URL
- 请求参数
- 响应状态
- 响应内容

### 3. 检查数据库数据

使用 SQL 查询检查用户数据：

```sql
-- 查看所有用户
SELECT
  u.email,
  u.created_at,
  p.username,
  p.role
FROM auth.users u
LEFT JOIN profiles p ON u.id = p.id
ORDER BY u.created_at DESC;

-- 查询特定用户名
SELECT * FROM profiles WHERE username = '3331631570';

-- 查询特定邮箱
SELECT * FROM profiles WHERE email = '3331631570@qq.com';
```

## 改进内容

### 1. 增强的日志系统

- ✅ 添加了详细的步骤日志
- ✅ 区分邮箱和用户名登录
- ✅ 显示查询结果
- ✅ 显示错误详情

### 2. 更好的错误处理

- ✅ 区分不同类型的错误
- ✅ 提供清晰的错误消息
- ✅ 记录错误日志

### 3. 性能优化

- ✅ 移除了超时机制（可能导致不必要的错误）
- ✅ 简化了查询逻辑
- ✅ 优化了错误处理流程

## 下一步

如果登录仍然失败，请：

1. 复制控制台中的完整日志
2. 截图错误信息
3. 告诉我具体的错误内容

这样我可以更准确地定位问题！

## 重要提示

⚠️ **你的用户名是 `3331631570`，不是 `xbx`！**

请使用以下任一方式登录：

- 用户名：`3331631570` + 密码
- 邮箱：`3331631570@qq.com` + 密码
